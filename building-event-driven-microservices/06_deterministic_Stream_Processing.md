# 6장. 확정적 스트림 처리
- 스트림을 처리/관리하는 방법

## 6.1. 이벤트 기반 워크플로우의 확정성
- 처리방법
  - 실시간에 가깝게 처리
  - 과거부터 이벤트를 처리해서 현재를 따라잡는 방법(catch-up)
- 가장 중요한 목표는 마이크로서비스가 동일한 출력을 내도록 하는 것

## 6.2. 타임스탬프
- 이벤트 스트림에 저장된 이벤트는 오프셋과 타임스탬프를 둘 다 가지고 있음
  - 오프셋 - 컨슈머가 이벤트를 어디까지 읽었는지
  - 타임스탬프 - 이벤트가 언제 생성되었는지
    - 이벤트 처리시점의 선후 관계를 파악할 수 있기 때문에 순서를 보장할 수 있게 됨

## 6.3. 이벤트 스케줄링과 확정적 처리
- 별도의 구현 필요

## 6.4. 워터마크
- 처리 토폴로지를 흐르면서 이벤트 시간의 진행 상황을 추적하고 주어진 이벤트 시간의 모든 데이터가 처리 완료 됐음을 선언하기 위해 사용
- 데이터 흐름 관리
- Apache Spark, Apache Flink, Apache Samzam, Apache Beam

## 6.5. 스트림 시간
- Apache Kafka Streams가 사용
  - 처리된 이벤트 중 가장 높은 타임스탬프를 유지

## 6.6. 비순차 이벤트와 지연 이벤트
- 비순차적인 데이터와 지연 이벤트의 발생가능성, 그리고 비즈니스의 영향도에 대해 고민이 필요

## 6.7. 지연 이벤트 처리
- 폐기
- 대기
- 유예

## 6.8. 재처리
- 이벤트 스트림을 리파티셔닝(신규 스트림 생성)할 경우 이벤트 순서가 맞지 않을 수 있어서 재처리 프로세스가 필요

## 6.9. 간헐적 실패와 지연 이벤트
- 뒷장에서 설명

## 6.10. 프로듀서/이벤트 브로커 연결 문제
- 견고한 지연 이벤트 처리 로직을 컨슈머 코드에 구현하는것도 괜찮은 방법